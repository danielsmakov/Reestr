@{
    ViewBag.Title = "Organizations";
}
@model List<Reestr.BLL.DTOs.OrganizationDTO>
@using Kendo.Mvc.UI



<div id="example">
    <div class="demo-section k-content">

        <div id="window">
            <p>sailbfvlasbvosaibcosaibclasblvjbsalkbjjjjjjjjjvsavascasasdas</p>
        </div>
        <span id="undo" class="k-button hide-on-narrow">Добавить запись</span>

        <h4>Combo Box:</h4>
        <input id="fabric" placeholder="Select fabric..." />
        
        <h4>Реестр организаций:</h4>
        <div id="grid"></div>
    </div>
    <script>
        $(document).ready(function () {

            var myWindow = $("#window"),
                undo = $("#undo");

            undo.click(function () {
                myWindow.data("kendoWindow").open();
                undo.fadeOut();
            });

            function onClose() {
                undo.fadeIn();
            };

            myWindow.kendoWindow({
                width: "600px",
                height: "600px",
                title: "Добавление организации",
                visible: false,
                actions: [
                    "Minimize",
                    "Maximize",
                    "Close"
                ],
                close: onClose
            }).data("kendoWindow").center();

            $("#fabric").kendoComboBox({
                dataTextField: "text",
                dataValueField: "value",
                dataSource: [
                    { text: "Cotton", value: "1" },
                    { text: "Polyester", value: "2" },
                    { text: "Cotton/Polyester", value: "3" },
                    { text: "Rib Knit", value: "4" },
                ],
                filter: "contains",
                suggest: true,
                index: 3
            });



            var dataSource = new kendo.data.DataSource({
                type: "odata",
                transport: {
                    read: {
                        url: "/Organization/List",
                        type: "GET",
                        dataType: "json",
                        contentType: "",
                        data: function () {
                            return {
                                Offset: $('#grid').data('kendoGrid').dataSource.skip(),
                                Limit: $('#grid').data('kendoGrid').dataSource.pageSize()
                            }
                        }
                    },
                    create: {
                        url: "/Organization/Insert",
                        type: "POST",
                        dataType: "json",
                    },
                    update: {
                        url: "/Organization/Update",
                        type: "POST",
                        dataType: "json"
                    },
                    destroy: {
                        url: "/Organization/Delete",
                        @*type: "POST",*@
                        contentType: "application/json",
                        dataType: "json"
                    }
                },
                pageSize: 20,
                serverPaging: true,
                schema: {
                    data: "Data",
                    total: "Total",
                    model: {
                        id: "Id",
                        fields: {
                            Id: { type: "number", editable: false, nullable: true},
                            Name: { type: "string", validation: { required: true } },
                            BIN: { type: "string", validation: { required: true } },
                            PhoneNumber: { type: "string", validation: { required: true } },
                            BeginDate: { type: "date", validation: { required: true } }
                        }
                    }
                }
            });



            $("#grid").kendoGrid({
                dataSource: dataSource,
                pageable: true,
                height: 550,
                sortable: true,
                toolbar: [{ name: "create", text: "Добавить" }, { name: "search", text: "Поиск..." }],
                columns: [
                    { field: "Name", title: "Название", width: 240 },
                    { field: "BIN", title: "БИН", width: 120 },
                    { field: "PhoneNumber", title: "Номер телефона", width: 120 },
                    { field: "BeginDate", title: "Дата начала действия", format: "{0:dd/MM/yyyy}", width: 120 },
                    { command: [{ name: "edit", text: "Редактировать" }, { name: "destroy", text: "Удалить" }], width: 170 }],
                editable: {
                    mode: "popup",
                    confirmation: "Вы уверены, что хотите удалить запись?",
                    command: [{ name: "edit", text: { edit: "Подтвердить", cancel: "Отмена" } }],
                    window: {
                        title: "",
                        animation: true,
                    },
                },
                edit: function (e) {
                    var update = $(e.container).parent().find(".k-grid-update");
                    var cancel = $(e.container).parent().find(".k-grid-cancel");
                    $(update).html('<span class="k-update">Подтвердить</span>');
                    $(cancel).html('<span class="k-cancel">Отмена</span>');
                },	
            });


        });
    </script>
</div>





@* Разметка ниже использовалась для тестирования backend'а *@
@*<div>
    <button>
        @Html.ActionLink("Insert Organization", "Insert", "Home");
    </button>
    <button>
        @Html.ActionLink("Update Organization", "Update", "Home");
    </button>
    <button>
        @Html.ActionLink("List Organizations", "List", "Home");
    </button>
    <button>
        @Html.ActionLink("Delete Organizations", "Delete", "Home");
    </button>

</div>*@

@*<div class="container" style="margin-top: 100px">
    @(Html.Kendo().Grid<Reestr.BLL.DTOs.OrganizationDTO>()
        .Name("OrganizationGrid")
        .Columns(columns =>
        {
            columns.Bound(o => o.Name).Width(200);
            columns.Bound(o => o.BIN).Width(200);
            columns.Bound(o => o.PhoneNumber).Width(200);
            columns.Bound(o => o.BeginDate).Format("{0:dd.MM.yyyy}").Width(200);
            columns.Command(command => { command.Edit(); command.Destroy(); });
        })
        .ToolBar(toolBar => toolBar.Create())
        .Editable(editable => editable.Mode(GridEditMode.PopUp))
        .Pageable()
        .Scrollable()
        .Sortable()
        .DataSource(dataSource => dataSource
            .Ajax()
            .PageSize(20)
            .Model(model => model.Id(o => o.Id))
            .Read(read => read.Action("List", "Home"))
            .Create(create => create.Action("Insert", "Home"))
            .Update(update => update.Action("Update", "Home"))
            .Destroy(destroy => destroy.Action("Delete", "Home"))
        )
    )
</div>*@